<!-- vale off -->

# Using Buildkite with Honeycomb

<!-- vale on -->

[Honeycomb](https://www.honeycomb.io/) is an observability and application performance management (APM) platform. Some of the advantages of using Honeycomb for observability with Buildkite is that Honeycomb has a free plan so you can start using it with Buildkite without additional expenses. Also, with Honeycomb it is possible to group traced jobs into a single build.

Honeycomb can be integrated with Buildkite through two main methods - [buildevents binary](https://github.com/honeycombio/buildevents) and Honeycomb [Marker Buildkite plugin](https://www.honeycomb.io/integration/buildkite-markers). You can also send traces from the Buildkite agent to Honeycomb using [OpenTelemetry](/docs/agent/v3/tracing#using-opentelemetry-tracing).

## Buildkite buildevents

Honeycomb's [Buildkite buildevents](https://www.honeycomb.io/integration/buildkite-buildevents) integration is used for helping builds generate trace telemetry. The [buildevents binary](https://github.com/honeycombio/buildevents) is usually invoked as part of each step in a Buildkite build to capture invocation and output details. The trace generated at the end contains details about the events of the entire Buildkite build.

The traces generated by buildevents contain spans for each section and subsection of the build. Each span represents individual or groups of the executed commands.

The duration of each span represents the runtime of the stage or specific command. Each span also contains the information whether the build was successful or failed as well as any additional data you choose to capture. Once a build finishes running, buildevents integration will send the trace to Honeycomb.

<%= image "honeycomb-buildevents.png", size: '1030x1236', alt: 'Buildkite buildevents in the Honeycomb UI' %>

The buildevents script needs a unique Trace ID to join together all of the steps and commands with the build. You can use Buildkite's `BUILDKITE_BUILD_ID` environment variable since it is both unique (even when re-running builds, you will get a new `BUILDKITE_BUILD_ID`) and is also a primary value that the build system uses to identify the build.

You can get started with using Buildkite buildevents by following the [installation instructions](https://github.com/honeycombio/buildevents?tab=readme-ov-file#installation). Please note that Buildkite buildevents is maintained by Honeycomb so please address any questions or feature requests to the [Honeycomb Support Portal](https://www.honeycomb.io/support).

<!-- vale off -->

## Buildkite Markers in Honeycomb

<!-- vale on -->

[Buildkite Markers](https://www.honeycomb.io/integration/buildkite-markers) allow indicating points in time on the Honeycomb graphs where significant events, such as deploys or outages, happen. You can list, create, update, and delete the Markers.

To add Buildkite Markers in Honeycomb, use the dedicated [open-source Honeycomb Marker Buildkite plugin](https://github.com/tendnz/honeymarker-buildkite-plugin). The plugin uses the Honeycomb Markers API by running JQ and CURL to create markers. It requires configuration of the fields you will set in your markers.

To use the Honeycomb Marker Buildkite plugin in your Buildkite pipeline with all the available customizable options, add the following to your pipeline configuration:

```yaml
steps:
  - command: make
    plugins:
      - tendnz/honeymarker#v1.0.{latest_plugin_version}:
          message: "v1.1.${BUILDKITE_BUILD_NUMBER}"
          writekey: ${HONEYCOMB_WRITE_KEY}
          dataset: "your-dataset-name"
          url: ${BUILDKITE_BUILD_URL}
          updatekey: "deploy-$ENV"
```

> ðŸš§ Warning!
> Please keep in mind that this example is aimed at providing you with a basic understanding of how it is possible to use Buildkite with Honeycomb with the help of a plugin. For a production-ready implementation, we [strongly advise against](/docs/pipelines/security/secrets/risk-considerations) using secrets in plaintext pipeline files. Instead, the recommended way of handling secrets would be by using the [Buildkite secrets](https://buildkite.com/docs/pipelines/security/secrets/buildkite-secrets)-based approach. So you should put the actual secret values in your secrets and use the `ENV` name.

For more examples and description of the options, please refer to the Honeycomb Marker Buildkite Plugin's [readme](https://github.com/tendnz/honeymarker-buildkite-plugin/blob/master/README.md) file.

## OpenTelemetry tracing

You can send traces from the Buildkite agent to Honeycomb with the help of OpenTelemetry by setting `--tracing-backend opentelemetry` flag and adding the following environment variables to your Buildkite pipeline definition:

```yaml
OTEL_EXPORTER_OTLP_TRACES_ENDPOINT="https://api.honeycomb.io"
OTEL_EXPORTER_OTLP_HEADERS="x-honeycomb-team=<api_key>"
OTEL_SERVICE_NAME="buildkite-agent"
```
