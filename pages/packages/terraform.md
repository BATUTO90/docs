# Terraform

Buildkite Packages provides registry support for Terraform packages.

Once your Terraform package registry has been [created](/docs/packages/manage-registries#create-a-registry), you can publish/upload packages (generated from your application's build) to this registry via the `curl` command presented on your Terraform package registry's details page.

To view and copy this `curl` command:

1. Select _Packages_ in the global navigation to access the _Repositories_ page.
1. Select your Terraform package registry on this page.
1. Select _Publish a Terraform Package_ and in the resulting dialog, use the copy icon at the top-right of the code box to copy this curl command and submit it to publish a package to your Terraform package registry.

This command provides:

- The specific URL to publish a package to your specific Terraform package registry in Buildkite.
- The API write token (generated by Buildkite Packages) required to publish packages to your Terraform package registry.

## Publish a package

The following `curl` command (modified accordingly before submitting) describes the process above to publish a package to your Terraform package registry:

```bash
curl -X POST https://buildkitepackages.com/api/v1/repos/{org.slug}/{registry.name}/packages.json \
  -H "Authorization: Bearer $PACKAGE_REGISTRY_WRITE_TOKEN" \
  -F "package[package_file]=@<path_to_file>"
```

where:

<%= render_markdown partial: 'packages/org_slug' %>

<%= render_markdown partial: 'packages/terraform_package_registry_name' %>

- `$PACKAGE_REGISTRY_WRITE_TOKEN` is the Buildkite Packages-generated API token required to publish/upload packages to your Terraform package registry.

<%= render_markdown partial: 'packages/path_to_file' %>

For example, to upload the file `my-terraform-package-1.0.1.tgz` from the current directory to the _My-Terraform-packages_ registry in the _My organization_ Buildkite organization, run the `curl` command:

```bash
curl -X POST https://buildkitepackages.com/api/v1/repos/my-organization/my-terraform-packages/packages.json \
  -H "Authorization: Bearer $REPLACE_WITH_MY_PACKAGE_REGISTRY_WRITE_TOKEN" \
  -F "package[package_file]=@my-terraform-package-1.0.1.tgz"
```

## Access a package's details

A Terraform package's details can be accessed from this registry using the _Packages_ section of your Terraform package registry page.

To access your Terraform package's details page:

1. Select _Packages_ in the global navigation to access the _Repositories_ page.
1. Select your Terraform package registry on this page.
1. Select the package within the _Packages_ section of the Terraform package registry page. The package's details page is displayed.

<%= render_markdown partial: 'packages/package_details_page_sections' %>

### Downloading a package

A Terraform package can be downloaded from the package's details page.

To download a package:

1. [Access the package's details](#access-a-packages-details).
1. Select _Download_.

### Installing a package

1. [Access the package's details](#access-a-packages-details).
1. Ensure the _Installation_ > _Installation instructions_ section is displayed.
1. Copy the code snippet and paste this into the Terraform file to install this Terraform package.

    Add this to the Terraform file:

    ```terraform
    * Add this to your terraform file:

    module "org_slug___registry_name_package_name" {
      source = "buildkitepackages.com/org-slug---registry-name/ksh/all"
      version = "1.0.1"
    }

    * Run 'terraform init'
    ```

    where:
    * `org_slug` can be derived from the end of your Buildkite URL (in [snake_case](https://en.wikipedia.org/wiki/Letter_case#Snake_case)), after accessing _Pipelines_ in the global navigation of your organization in Buildkite.
    * `registry_name` is the name of your Terraform package registry (in snake_case).
    * `package_name` is the name of your Terraform package.
    * `org-slug` can be obtained from the end of your Buildkite URL (in [kebab-case](https://en.wikipedia.org/wiki/Letter_case#Kebab_case)), after accessing _Pipelines_ in the global navigation of your organization in Buildkite.
    * `registry-name` is the name of your Terraform package registry (in kebab-case).

1. Run the Terraform command:

    ```bash
    terraform init
    ```
